(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{3146:function(e,n,o){Promise.resolve().then(o.bind(o,6128)),Promise.resolve().then(o.t.bind(o,7827,23)),Promise.resolve().then(o.t.bind(o,7960,23))},6128:function(e,n,o){"use strict";o.d(n,{AuthProvider:function(){return i},a:function(){return a}});var t=o(7437),r=o(2265),s=o(5452);let l=(0,r.createContext)(void 0);function i(e){let{children:n}=e,[o,i]=(0,r.useState)(null),[a,u]=(0,r.useState)(null),[c,d]=(0,r.useState)(!0),[f,v]=(0,r.useState)(!0),g=(0,s.createClientComponentClient)(),{wasHardRefresh:h}=function(){let e=(0,r.useRef)(!1);return(0,r.useEffect)(()=>{let n=performance.getEntriesByType("navigation");if(n.length>0){let o=n[0];e.current="reload"===o.type,e.current&&console.log("\uD83D\uDD04 Hard refresh detectado - preservando estado de autentica\xe7\xe3o")}let o=n=>{(n.altKey&&"F5"===n.key||n.ctrlKey&&"F5"===n.key||n.ctrlKey&&n.shiftKey&&"R"===n.key||n.metaKey&&n.shiftKey&&"R"===n.key)&&(console.log("Hard refresh key combination detected"),e.current=!0,sessionStorage.setItem("hardRefreshFlag","true"))};return sessionStorage.getItem("hardRefreshFlag")&&(console.log("Previous hard refresh detected from sessionStorage"),e.current=!0,sessionStorage.removeItem("hardRefreshFlag")),document.addEventListener("keydown",o),()=>{document.removeEventListener("keydown",o)}},[]),{wasHardRefresh:e.current}}(),m=e=>{if(!e)return!1;let n=Math.floor(Date.now()/1e3);return!e.expires_at||e.expires_at>n},y=e=>{if(!e)return!1;let n=Math.floor(Date.now()/1e3);return!!e.expires_at&&e.expires_at<n+300},_=async()=>{try{console.log("Tentando renovar sess\xe3o...");let{data:e,error:n}=await g.auth.refreshSession();if(n)return console.error("Erro ao renovar sess\xe3o:",n),!1;if(e.session)return console.log("Sess\xe3o renovada com sucesso!"),u(e.session),i(e.session.user),!0;return!1}catch(e){return console.error("Erro inesperado ao renovar sess\xe3o:",e),!1}};(0,r.useEffect)(()=>{let e=!0,n=async function(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3;try{if(console.log("Getting initial session, attempt:",4-o),f||h){let e=h?300:100;console.log("Waiting ".concat(e,"ms for Supabase client initialization...")),await new Promise(n=>setTimeout(n,e))}let{data:{session:r},error:s}=await g.auth.getSession();if(!e)return;if(s){if(console.error("Error getting session:",s),o>0){setTimeout(()=>n(o-1),200);return}u(null),i(null)}else{var t;console.log("Initial session loaded:",(null==r?void 0:null===(t=r.user)||void 0===t?void 0:t.email)||"No user"),r&&m(r)?(u(r),i(r.user)):r&&!m(r)?(console.log("Session expired, attempting refresh..."),g.auth.refreshSession()):(u(null),i(null))}}catch(t){if(console.error("Error in getInitialSession:",t),!e)return;if(o>0){setTimeout(()=>n(o-1),200);return}u(null),i(null)}finally{e&&(d(!1),v(!1))}};n();let{data:{subscription:o}}=g.auth.onAuthStateChange(async(n,o)=>{var t,r,s,l,a;if(e)switch(console.log("Auth event:",n,(null==o?void 0:null===(t=o.user)||void 0===t?void 0:t.email)||"No user"),f||d(!1),n){case"SIGNED_IN":case"TOKEN_REFRESHED":console.log("User ".concat(n.toLowerCase(),":"),null==o?void 0:null===(r=o.user)||void 0===r?void 0:r.email),u(o),i(null!==(s=null==o?void 0:o.user)&&void 0!==s?s:null);break;case"SIGNED_OUT":console.log("User signed out"),u(null),i(null);break;case"INITIAL_SESSION":console.log("Initial session event:",(null==o?void 0:null===(l=o.user)||void 0===l?void 0:l.email)||"No user"),u(o),i(null!==(a=null==o?void 0:o.user)&&void 0!==a?a:null)}}),t=setInterval(()=>{a&&y(a)&&(console.log("Sess\xe3o expirando em breve, renovando automaticamente..."),_())},6e4);return()=>{console.log("Cleaning up auth subscription and timers"),e=!1,o.unsubscribe(),clearInterval(t)}},[g.auth,f]);let S=async()=>{try{console.log("Signing out user explicitly"),d(!0),u(null),i(null);let{error:e}=await g.auth.signOut();e?console.error("Error signing out:",e):console.log("Successfully signed out")}catch(e){console.error("Error signing out:",e)}finally{d(!1)}};return(0,t.jsx)(l.Provider,{value:{user:o,session:a,loading:c,signOut:S},children:n})}function a(){let e=(0,r.useContext)(l);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},7960:function(){},7827:function(e){e.exports={style:{fontFamily:"'__DM_Sans_d23d47', '__DM_Sans_Fallback_d23d47'",fontStyle:"normal"},className:"__className_d23d47",variable:"__variable_d23d47"}}},function(e){e.O(0,[371,587,452,971,117,744],function(){return e(e.s=3146)}),_N_E=e.O()}]);