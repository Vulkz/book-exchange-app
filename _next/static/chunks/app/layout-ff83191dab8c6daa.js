(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{3146:function(e,t,o){Promise.resolve().then(o.bind(o,6128)),Promise.resolve().then(o.t.bind(o,7827,23)),Promise.resolve().then(o.t.bind(o,7960,23))},6128:function(e,t,o){"use strict";o.d(t,{AuthProvider:function(){return l},a:function(){return i}});var n=o(7437),r=o(2265),s=o(5452);let a=(0,r.createContext)(void 0);function l(e){let{children:t}=e,[o,l]=(0,r.useState)(null),[i,u]=(0,r.useState)(null),[c,d]=(0,r.useState)(!0),[f,h]=(0,r.useState)(!0),g=(0,s.createClientComponentClient)(),{wasHardRefresh:v}=function(){let e=(0,r.useRef)(!1);return(0,r.useEffect)(()=>{let t=performance.getEntriesByType("navigation");if(t.length>0){let o=t[0];e.current="reload"===o.type,e.current&&console.log("\uD83D\uDD04 Hard refresh detectado - preservando estado de autentica\xe7\xe3o")}let o=t=>{(t.altKey&&"F5"===t.key||t.ctrlKey&&"F5"===t.key||t.ctrlKey&&t.shiftKey&&"R"===t.key||t.metaKey&&t.shiftKey&&"R"===t.key)&&(console.log("Hard refresh key combination detected"),e.current=!0,sessionStorage.setItem("hardRefreshFlag","true"))};return sessionStorage.getItem("hardRefreshFlag")&&(console.log("Previous hard refresh detected from sessionStorage"),e.current=!0,sessionStorage.removeItem("hardRefreshFlag")),document.addEventListener("keydown",o),()=>{document.removeEventListener("keydown",o)}},[]),{wasHardRefresh:e.current}}(),m=e=>{if(!e)return!1;let t=Math.floor(Date.now()/1e3);return!e.expires_at||e.expires_at>t},y=e=>{if(!e)return!1;let t=Math.floor(Date.now()/1e3);return!!e.expires_at&&e.expires_at<t+300},_=async()=>{try{console.log("Tentando renovar sess\xe3o...");let{data:e,error:t}=await g.auth.refreshSession();if(t)return console.error("Erro ao renovar sess\xe3o:",t),!1;if(e.session)return console.log("Sess\xe3o renovada com sucesso!"),u(e.session),l(e.session.user),!0;return!1}catch(e){return console.error("Erro inesperado ao renovar sess\xe3o:",e),!1}};(0,r.useEffect)(()=>{let e=!0,t=setTimeout(()=>{e&&(console.log("[AuthContext] FailSafe: liberando loading ap\xf3s timeout"),d(!1))},3e3),o=async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3;try{if(console.log("Getting initial session, attempt:",4-t),f||v){let e=v?300:100;console.log("Waiting ".concat(e,"ms for Supabase client initialization...")),await new Promise(t=>setTimeout(t,e))}let{data:{session:r},error:s}=await g.auth.getSession();if(!e)return;if(s){if(console.warn("[AuthContext] Erro ao obter sess\xe3o:",s.message),t>0){setTimeout(()=>o(t-1),200);return}u(null),l(null)}else{var n;console.log("Initial session loaded:",(null==r?void 0:null===(n=r.user)||void 0===n?void 0:n.email)||"No user"),r&&m(r)?(u(r),l(r.user)):(u(null),l(null))}}catch(e){console.error("[AuthContext] Exce\xe7\xe3o getInitialSession:",e)}finally{e&&(d(!1),h(!1))}};o();let{data:{subscription:n}}=g.auth.onAuthStateChange((t,o)=>{if(e)switch(console.log("[AuthContext] Auth event:",t),t){case"SIGNED_IN":case"TOKEN_REFRESHED":case"INITIAL_SESSION":var n;u(o),l(null!==(n=null==o?void 0:o.user)&&void 0!==n?n:null),d(!1);break;case"SIGNED_OUT":u(null),l(null),d(!1)}}),r=setInterval(()=>{i&&y(i)&&(console.log("Sess\xe3o expirando em breve, renovando automaticamente..."),_())},6e4);return()=>{console.log("Cleaning up auth subscription and timers"),e=!1,clearTimeout(t),n.unsubscribe(),clearInterval(r)}},[g.auth,f]);let S=async()=>{try{console.log("Signing out user explicitly"),d(!0),u(null),l(null);let{error:e}=await g.auth.signOut();e?console.error("Error signing out:",e):console.log("Successfully signed out")}catch(e){console.error("Error signing out:",e)}finally{d(!1)}};return(0,n.jsx)(a.Provider,{value:{user:o,session:i,loading:c,signOut:S},children:t})}function i(){let e=(0,r.useContext)(a);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},7960:function(){},7827:function(e){e.exports={style:{fontFamily:"'__DM_Sans_d23d47', '__DM_Sans_Fallback_d23d47'",fontStyle:"normal"},className:"__className_d23d47",variable:"__variable_d23d47"}}},function(e){e.O(0,[371,587,452,971,117,744],function(){return e(e.s=3146)}),_N_E=e.O()}]);