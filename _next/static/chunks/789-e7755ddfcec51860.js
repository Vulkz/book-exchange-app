"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[789],{173:function(e,t,a){a.d(t,{k:function(){return p}});var r=a(7437),s=a(2265),o=a(970),i=a(2869),n=a(5186),l=a(6815),c=a(6818),d=a(3647),u=a(6070),m=a(5974),f=a(1769),g=a(2489),h=a(3774),x=a(9397);function p(e){let{isOpen:t,onClose:a,onSuccess:p}=e,[v,b]=(0,s.useState)({title:"",author:"",description:"",category:""}),[y,j]=(0,s.useState)(""),[w,N]=(0,s.useState)([""]),[_,D]=(0,s.useState)(""),[E,S]=(0,s.useState)(!1),[k,C]=(0,s.useState)({}),I=e=>{let{name:t,value:a}=e.target;b(e=>({...e,[t]:a})),k[t]&&C(e=>({...e,[t]:""}))},q=(e,t)=>{b(a=>({...a,[e]:t})),k[e]&&C(t=>({...t,[e]:""}))},A=()=>{_.trim()&&!w.includes(_.trim())&&(N(e=>[...e.filter(e=>e.trim()),_.trim()]),D(""))},O=e=>{N(t=>t.filter((t,a)=>a!==e))},z=()=>{let e={};return v.title.trim()||(e.title="T\xedtulo \xe9 obrigat\xf3rio"),v.author.trim()||(e.author="Autor \xe9 obrigat\xf3rio"),v.description.trim()||(e.description="Descri\xe7\xe3o \xe9 obrigat\xf3ria"),v.category||(e.category="Categoria \xe9 obrigat\xf3ria"),0===w.filter(e=>e.trim()).length&&(e.locations="Adicione pelo menos um local de encontro"),C(e),0===Object.keys(e).length},T=async e=>{if(e.preventDefault(),z()){S(!0);try{let{data:{user:e}}=await o.OQ.auth.getUser();if(!e)throw Error("Usu\xe1rio n\xe3o autenticado");console.log("Inserting book for user:",e.id),console.log("Book data:",v);let{data:t,error:a}=await o.OQ.from("books").insert({title:v.title.trim(),author:v.author.trim(),description:v.description.trim(),category:v.category||"Literatura",owner_id:e.id,availability_status:"available",image_url:y.trim()||null}).select().single();if(console.log("Book insert result:",{bookData:t,bookError:a}),a)throw a;let r=w.filter(e=>e.trim());if(r.length>0){let e=r.map(e=>({book_id:t.id,location:e.trim()})),{error:a}=await o.OQ.from("meeting_locations").insert(e);if(a)throw a}b({title:"",author:"",description:"",category:""}),j(""),N([""]),D(""),C({}),console.log("Livro criado com sucesso:",t),alert("Livro adicionado com sucesso!"),p()}catch(e){console.error("Erro detalhado ao adicionar livro:",e),C({general:"Erro ao adicionar livro: ".concat(e.message||"Tente novamente.")})}finally{S(!1)}}};return t?(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,r.jsxs)(u.Zb,{className:"w-full max-w-md max-h-[90vh] overflow-y-auto",children:[(0,r.jsx)(u.Ol,{children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)(u.ll,{className:"flex items-center space-x-2",children:[(0,r.jsx)(f.Z,{className:"h-5 w-5"}),(0,r.jsx)("span",{children:"Adicionar Livro"})]}),(0,r.jsx)(i.z,{variant:"ghost",size:"sm",onClick:a,children:(0,r.jsx)(g.Z,{className:"h-4 w-4"})})]})}),(0,r.jsx)(u.aY,{children:(0,r.jsxs)("form",{onSubmit:T,className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(l._,{htmlFor:"title",children:"T\xedtulo *"}),(0,r.jsx)(n.I,{id:"title",name:"title",value:v.title,onChange:I,className:k.title?"border-red-500":"",placeholder:"Ex: Dom Casmurro",required:!0}),k.title&&(0,r.jsx)("p",{className:"text-sm text-red-500 mt-1",children:k.title})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(l._,{htmlFor:"author",children:"Autor *"}),(0,r.jsx)(n.I,{id:"author",name:"author",value:v.author,onChange:I,className:k.author?"border-red-500":"",placeholder:"Ex: Machado de Assis",required:!0}),k.author&&(0,r.jsx)("p",{className:"text-sm text-red-500 mt-1",children:k.author})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(l._,{htmlFor:"category",children:"Categoria *"}),(0,r.jsxs)(d.Ph,{onValueChange:e=>q("category",e),value:v.category,children:[(0,r.jsx)(d.i4,{className:k.category?"border-red-500":"",children:(0,r.jsx)(d.ki,{placeholder:"Selecione uma categoria"})}),(0,r.jsx)(d.Bw,{children:["Literatura Brasileira","Literatura Estrangeira","Fic\xe7\xe3o Cient\xedfica","Fantasia","Romance","Suspense/Thriller","Hist\xf3ria","Biografia","Autoajuda","Tecnologia","Ci\xeancia","Psicologia","Filosofia","Arte","Culin\xe1ria","Esportes","Infantil","Jovem Adulto","Educa\xe7\xe3o","Neg\xf3cios","Outros"].map(e=>(0,r.jsx)(d.Ql,{value:e,children:e},e))})]}),k.category&&(0,r.jsx)("p",{className:"text-sm text-red-500 mt-1",children:k.category})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(l._,{htmlFor:"imageUrl",children:"URL da Imagem (opcional)"}),(0,r.jsx)(n.I,{id:"imageUrl",name:"imageUrl",type:"url",value:y,onChange:e=>j(e.target.value),placeholder:"Ex: https://exemplo.com/imagem-do-livro.jpg"}),(0,r.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"Cole o link de uma imagem da capa do livro (opcional)"}),y&&(0,r.jsx)("div",{className:"mt-2",children:(0,r.jsx)("img",{src:y,alt:"Preview",className:"w-20 h-28 object-cover rounded border",onError:()=>j("")})})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(l._,{htmlFor:"description",children:"Descri\xe7\xe3o *"}),(0,r.jsx)(c.g,{id:"description",name:"description",value:v.description,onChange:I,className:k.description?"border-red-500":"",placeholder:"Descreva o livro, sua condi\xe7\xe3o, temas principais...",rows:3,required:!0}),k.description&&(0,r.jsx)("p",{className:"text-sm text-red-500 mt-1",children:k.description})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)(l._,{className:"flex items-center space-x-2 mb-2",children:[(0,r.jsx)(h.Z,{className:"h-4 w-4"}),(0,r.jsx)("span",{children:"Locais de Encontro *"})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{className:"flex space-x-2",children:[(0,r.jsx)(n.I,{value:_,onChange:e=>D(e.target.value),placeholder:"Ex: Biblioteca Central, Caf\xe9 do Centro...",className:"flex-1",onKeyPress:e=>{"Enter"===e.key&&(e.preventDefault(),A())}}),(0,r.jsx)(i.z,{type:"button",onClick:A,variant:"outline",size:"sm",children:(0,r.jsx)(x.Z,{className:"h-4 w-4"})})]}),w.filter(e=>e.trim()).map((e,t)=>(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsxs)(m.C,{variant:"secondary",className:"flex-1 justify-start",children:[(0,r.jsx)(h.Z,{className:"h-3 w-3 mr-1"}),e]}),(0,r.jsx)(i.z,{type:"button",onClick:()=>O(t),variant:"ghost",size:"sm",children:(0,r.jsx)(g.Z,{className:"h-3 w-3"})})]},t))]}),k.locations&&(0,r.jsx)("p",{className:"text-sm text-red-500 mt-1",children:k.locations})]}),k.general&&(0,r.jsx)("p",{className:"text-sm text-red-500",children:k.general}),(0,r.jsxs)("div",{className:"flex space-x-2 pt-4",children:[(0,r.jsx)(i.z,{type:"submit",disabled:E,className:"flex-1",children:E?"Adicionando...":"Adicionar Livro"}),(0,r.jsx)(i.z,{type:"button",variant:"outline",onClick:a,children:"Cancelar"})]})]})})]})}):null}},9703:function(e,t,a){a.d(t,{W:function(){return N}});var r=a(7437),s=a(7648),o=a(9376),i=a(2869),n=a(5974),l=a(1769),c=a(2369),d=a(6949),u=a(4766),m=a(2718),f=a(2265),g=a(3417),h=a(401),x=a(2489),p=a(1047),v=a(3774),b=a(970),y=a(5427),j=a(7992);function w(e){let{userId:t}=e,{notifications:a,unreadCount:s,loading:o,markAsRead:i,markAllAsRead:n}=function(e){let[t,a]=(0,f.useState)(()=>{if(e)try{let t=localStorage.getItem("notifications_".concat(e));return t?JSON.parse(t):[]}catch(e){console.warn("Erro ao carregar notifica\xe7\xf5es do cache:",e)}return[]}),[r,s]=(0,f.useState)(()=>{if(e)try{let t=localStorage.getItem("unreadCount_".concat(e));return t?parseInt(t,10):0}catch(e){console.warn("Erro ao carregar contador do cache:",e)}return 0}),[o,i]=(0,f.useState)(!0);(0,f.useEffect)(()=>{if(e&&""!==e.trim())try{localStorage.setItem("notifications_".concat(e),JSON.stringify(t)),localStorage.setItem("unreadCount_".concat(e),r.toString()),localStorage.setItem("notifications_lastUpdate_".concat(e),Date.now().toString()),console.log("\uD83D\uDCBE Notifica\xe7\xf5es salvas no cache:",{userId:e,count:t.length,unread:r})}catch(e){console.warn("Erro ao salvar notifica\xe7\xf5es no cache:",e)}},[t,r,e]),(0,f.useEffect)(()=>{if(console.log("\uD83D\uDE80 useRealTimeNotifications - userId recebido:",e),!e||""===e.trim()){console.warn("⚠️ userId inv\xe1lido ou n\xe3o fornecido para useRealTimeNotifications"),a([]),s(0),i(!1);return}try{let t=localStorage.getItem("notifications_".concat(e)),r=localStorage.getItem("notifications_lastUpdate_".concat(e));if(t&&r){let o=Date.now()-parseInt(r);if(o<6e4){let r=JSON.parse(t),i=localStorage.getItem("unreadCount_".concat(e));console.log("\uD83D\uDCE6 Usando cache v\xe1lido durante busca inicial:",{count:r.length,age:Math.round(o/1e3)+"s"}),a(r),s(i?parseInt(i):0)}}}catch(e){console.warn("Erro ao carregar cache inicial:",e)}(async()=>{try{console.log("\uD83D\uDCEC Buscando notifica\xe7\xf5es para usu\xe1rio:",e);let{data:r,error:o}=await b.OQ.from("notifications").select("*").eq("user_id",e).order("created_at",{ascending:!1});if(o&&o.message.includes("read")){console.log('⚠️ Coluna "read" n\xe3o encontrada, usando fallback...');let t=await b.OQ.from("notifications").select("id, user_id, type, title, message, created_at, data").eq("user_id",e).order("created_at",{ascending:!1});r=t.data,o=t.error}if(console.log("\uD83D\uDCCA Resultado da busca:",{total:(null==r?void 0:r.length)||0,error:o}),o){var t;if(console.error("❌ Erro ao buscar notifica\xe7\xf5es:",o),null===(t=o.message)||void 0===t?void 0:t.includes('column "read" does not exist')){console.log('\uD83D\uDD27 Coluna "read" n\xe3o existe, adaptando consulta...');let{data:t,error:r}=await b.OQ.from("notifications").select("id, user_id, type, title, message, created_at").eq("user_id",e).order("created_at",{ascending:!1});if(!r&&t){let e=t.map(e=>({...e,read:!1}));a(e),s(e.length),console.log("✅ Notifica\xe7\xf5es carregadas (modo compatibilidade):",e.length)}}return}let i=r||[],n=[],l=!1;try{let t=localStorage.getItem("notifications_".concat(e)),a=localStorage.getItem("unreadCount_".concat(e)),r=localStorage.getItem("notifications_lastUpdate_".concat(e));t&&r&&Date.now()-parseInt(r)<3e5&&(n=JSON.parse(t),a&&parseInt(a),l=0===i.length&&n.length>0)}catch(e){console.warn("Erro ao carregar cache:",e)}let c=i.length>0?i:l?n:[];a(c);let d=c.filter(e=>!e.read).length;s(d),console.log("✅ Notifica\xe7\xf5es sincronizadas:",{servidor:i.length,cache:n.length,useCache:l,final:c.length,unread:d})}catch(e){console.error("❌ Erro inesperado ao buscar notifica\xe7\xf5es:",e)}finally{i(!1)}})()},[e]),(0,f.useEffect)(()=>{if(!e||""===e.trim()){console.warn("⚠️ N\xe3o configurando listener: userId inv\xe1lido");return}let t=b.OQ.channel("notifications").on("postgres_changes",{event:"INSERT",schema:"public",table:"notifications",filter:"user_id=eq.".concat(e)},e=>{console.log("\uD83D\uDD14 Nova notifica\xe7\xe3o recebida:",e.new);let t=e.new;a(e=>[t,...e]),s(e=>e+1)}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"notifications",filter:"user_id=eq.".concat(e)},e=>{console.log("\uD83D\uDCDD Notifica\xe7\xe3o atualizada:",e.new);let t=e.new;a(e=>e.map(e=>e.id===t.id?t:e)),t.read&&s(e=>Math.max(0,e-1))}).subscribe();return console.log("\uD83D\uDCE1 Listener de tempo real configurado para usu\xe1rio:",e),()=>{console.log("\uD83E\uDDF9 Removendo listener de notifica\xe7\xf5es"),b.OQ.removeChannel(t)}},[e]),(0,f.useEffect)(()=>{if(!e||""===e.trim())return;let t=async()=>{console.log("\uD83D\uDD04 Evento de refetch recebido");try{i(!0),console.log("\uD83D\uDD04 Recarregando notifica\xe7\xf5es...");let{data:t,error:r}=await b.OQ.from("notifications").select("*").eq("user_id",e).order("created_at",{ascending:!1});if(r)throw r;let o=t||[];a(o);let n=o.filter(e=>!e.read).length;s(n),console.log("✅ Notifica\xe7\xf5es recarregadas via evento:",{total:o.length,unread:n})}catch(e){console.error("❌ Erro ao recarregar notifica\xe7\xf5es:",e)}finally{i(!1)}};return window.addEventListener("refetch-notifications",t),()=>{window.removeEventListener("refetch-notifications",t)}},[e]);let n=async()=>{if(!e||""===e.trim()){console.warn("⚠️ N\xe3o \xe9 poss\xedvel marcar como lidas: usu\xe1rio n\xe3o autenticado");return}try{console.log("\uD83D\uDCD6 Marcando todas as notifica\xe7\xf5es como lidas..."),a(e=>e.map(e=>({...e,read:!0}))),s(0);let{error:i}=await b.OQ.from("notifications").update({read:!0}).eq("user_id",e).eq("read",!1);if(i){var o;if(null===(o=i.message)||void 0===o?void 0:o.includes('column "read" does not exist')){console.log('⚠️ Coluna "read" n\xe3o existe, mantendo mudan\xe7a local');return}throw a(t),s(r),i}console.log("✅ Todas as notifica\xe7\xf5es marcadas como lidas")}catch(e){throw console.error("❌ Erro ao marcar todas como lidas:",e),Error("Falha ao marcar todas as notifica\xe7\xf5es como lidas")}};return{notifications:t,unreadCount:r,loading:o,markAsRead:async t=>{if(!e||""===e.trim()){console.warn("⚠️ N\xe3o \xe9 poss\xedvel marcar como lida: usu\xe1rio n\xe3o autenticado");return}try{console.log("\uD83D\uDCD6 Marcando notifica\xe7\xe3o como lida:",t),a(e=>e.map(e=>e.id===t?{...e,read:!0}:e)),s(e=>Math.max(0,e-1));let{error:e}=await b.OQ.from("notifications").update({read:!0}).eq("id",t);if(e){var r;if(null===(r=e.message)||void 0===r?void 0:r.includes('column "read" does not exist')){console.log('⚠️ Coluna "read" n\xe3o existe, opera\xe7\xe3o ignorada');return}throw a(e=>e.map(e=>e.id===t?{...e,read:!1}:e)),s(e=>e+1),e}console.log("✅ Notifica\xe7\xe3o marcada como lida")}catch(e){throw console.error("❌ Erro ao marcar notifica\xe7\xe3o como lida:",e),Error("Falha ao marcar notifica\xe7\xe3o como lida")}},markAllAsRead:n,refetchNotifications:async()=>{if(!e||""===e.trim()){console.warn("⚠️ N\xe3o \xe9 poss\xedvel recarregar: usu\xe1rio n\xe3o autenticado");return}try{i(!0),console.log("\uD83D\uDD04 Recarregando notifica\xe7\xf5es...");let{data:t,error:r}=await b.OQ.from("notifications").select("*").eq("user_id",e).order("created_at",{ascending:!1});if(r)throw r;let o=t||[];a(o);let n=o.filter(e=>!e.read).length;s(n),console.log("✅ Notifica\xe7\xf5es recarregadas:",{total:o.length,unread:n})}catch(e){console.error("❌ Erro ao recarregar notifica\xe7\xf5es:",e)}finally{i(!1)}}}}(t),{respondToRequest:l}=(0,y.X)(t),[d,m]=(0,f.useState)(!1),[w,N]=(0,f.useState)(null),[_,D]=(0,f.useState)(0),E=t&&""!==t.trim();(0,f.useEffect)(()=>{console.log("\uD83D\uDD14 NotificationCenter - Estado atual:",{userId:t,isAuthenticated:E,notifications:a.length,unreadCount:s,loading:o})},[t,E,a.length,s,o]),(0,f.useEffect)(()=>{if(!E)return;let e=()=>{"visible"===document.visibilityState&&(console.log("\uD83D\uDC40 P\xe1gina ficou vis\xedvel - verificando notifica\xe7\xf5es..."),setTimeout(()=>{0===a.length&&(console.log("\uD83D\uDD04 Notifica\xe7\xf5es vazias ap\xf3s navega\xe7\xe3o - recarregando..."),window.dispatchEvent(new CustomEvent("refetch-notifications")))},100))};return document.addEventListener("visibilitychange",e),()=>{document.removeEventListener("visibilitychange",e)}},[E,a.length]),(0,f.useEffect)(()=>{a.length>_&&_>0&&a.slice(0,a.length-_).forEach(e=>{if(!e.read){let a="\uD83D\uDD14 Nova notifica\xe7\xe3o!",r=e.message;switch(e.type){case"book_request":case"new_request":var t;a="\uD83D\uDCDA Nova solicita\xe7\xe3o!",r="".concat((null===(t=e.data)||void 0===t?void 0:t.requester_name)||"Algu\xe9m"," quer pegar um livro emprestado");break;case"request_accepted":a="✅ Solicita\xe7\xe3o aceita!",r=e.message;break;case"request_rejected":a="❌ Solicita\xe7\xe3o recusada",r=e.message;break;default:a="\uD83D\uDD14 "+e.title,r=e.message}(0,j.Am)({title:a,description:r})}}),D(a.length)},[a,_]);let S=async e=>{var t;if(null===(t=e.data)||void 0===t?void 0:t.request_id){N(e.data.request_id);try{await l(e.data.request_id,"accepted","Solicita\xe7\xe3o aceita! Vamos combinar os detalhes."),await i(e.id),(0,j.Am)({title:"✅ Solicita\xe7\xe3o aceita!",description:"O usu\xe1rio foi notificado sobre sua decis\xe3o."})}catch(e){console.error("Erro ao aceitar solicita\xe7\xe3o:",e),(0,j.Am)({title:"❌ Erro",description:"N\xe3o foi poss\xedvel aceitar a solicita\xe7\xe3o.",variant:"destructive"})}finally{N(null)}}},k=async e=>{var t;if(null===(t=e.data)||void 0===t?void 0:t.request_id){N(e.data.request_id);try{await l(e.data.request_id,"rejected","Obrigado pelo interesse, mas n\xe3o posso emprestar no momento."),await i(e.id),(0,j.Am)({title:"❌ Solicita\xe7\xe3o recusada",description:"O usu\xe1rio foi notificado sobre sua decis\xe3o."})}catch(e){console.error("Erro ao rejeitar solicita\xe7\xe3o:",e),(0,j.Am)({title:"❌ Erro",description:"N\xe3o foi poss\xedvel recusar a solicita\xe7\xe3o.",variant:"destructive"})}finally{N(null)}}},C=e=>{switch(e){case"book_request":case"new_request":return(0,r.jsx)(g.Z,{className:"h-5 w-5 text-blue-500"});case"request_accepted":return(0,r.jsx)(h.Z,{className:"h-5 w-5 text-green-500"});case"request_rejected":return(0,r.jsx)(x.Z,{className:"h-5 w-5 text-red-500"});case"message":return(0,r.jsx)(g.Z,{className:"h-5 w-5 text-purple-500"});case"meeting":return(0,r.jsx)(p.Z,{className:"h-5 w-5 text-orange-500"});case"location":return(0,r.jsx)(v.Z,{className:"h-5 w-5 text-indigo-500"});case"user":return(0,r.jsx)(c.Z,{className:"h-5 w-5 text-teal-500"});default:return(0,r.jsx)(u.Z,{className:"h-5 w-5 text-gray-500"})}},I=e=>{let t=new Date(e),a=Math.floor((new Date().getTime()-t.getTime())/6e4);return a<1?"Agora":a<60?"".concat(a,"m atr\xe1s"):a<1440?"".concat(Math.floor(a/60),"h atr\xe1s"):"".concat(Math.floor(a/1440),"d atr\xe1s")};return(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsxs)("button",{onClick:()=>m(!d),className:"relative p-2 rounded-full transition-colors ".concat(E?"text-gray-600 hover:text-gray-900 hover:bg-gray-100":"text-gray-400 cursor-not-allowed"),title:E?"Notifica\xe7\xf5es":"Fa\xe7a login para ver notifica\xe7\xf5es",disabled:!E,children:[(0,r.jsx)(u.Z,{className:"h-6 w-6"}),s>0&&E&&(0,r.jsx)("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center animate-pulse",children:s>9?"9+":s})]}),d&&(0,r.jsxs)("div",{className:"absolute right-0 top-full mt-2 w-72 bg-white rounded-lg shadow-lg border border-gray-200 z-50 max-h-80 overflow-hidden",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between p-3 border-b bg-gray-50",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(u.Z,{className:"h-4 w-4 text-gray-600"}),(0,r.jsx)("h3",{className:"font-medium text-gray-900 text-sm",children:"Notifica\xe7\xf5es"}),s>0&&(0,r.jsxs)("span",{className:"bg-red-500 text-white text-xs px-2 py-0.5 rounded-full",children:[s," nova",s>1?"s":""]})]}),s>0&&(0,r.jsx)("button",{onClick:n,className:"text-xs text-blue-600 hover:text-blue-800 px-2 py-1 rounded",children:"Limpar"})]}),(0,r.jsx)("div",{className:"max-h-64 overflow-y-auto",children:o?(0,r.jsx)("div",{className:"p-3 text-center text-gray-500 text-sm",children:"Carregando..."}):E?0===a.length?(0,r.jsxs)("div",{className:"p-4 text-center text-gray-500",children:[(0,r.jsx)(u.Z,{className:"h-6 w-6 mx-auto mb-2 text-gray-300"}),(0,r.jsx)("p",{className:"text-sm",children:"Nenhuma notifica\xe7\xe3o"})]}):a.map(e=>{var t,a,s,o;return(0,r.jsx)("div",{className:"p-3 border-b last:border-b-0 hover:bg-gray-50 transition-colors cursor-pointer ".concat(e.read?"":"bg-blue-50 border-l-3 border-l-blue-500"),onClick:()=>!e.read&&i(e.id),children:(0,r.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,r.jsx)("div",{className:"flex-shrink-0 mt-0.5",children:C(e.type)}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsxs)("div",{className:"flex items-start justify-between",children:[(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsx)("h4",{className:"text-sm font-medium text-gray-900 truncate leading-tight",children:e.title}),(0,r.jsx)("p",{className:"text-xs text-gray-600 mt-1 line-clamp-2 leading-tight",children:e.message})]}),(0,r.jsxs)("div",{className:"flex flex-col items-end ml-2",children:[(0,r.jsx)("span",{className:"text-xs text-gray-500 whitespace-nowrap",children:I(e.created_at)}),!e.read&&(0,r.jsx)("div",{className:"w-2 h-2 bg-blue-500 rounded-full mt-1"})]})]}),("book_request"===e.type||"new_request"===e.type)&&!e.read&&(0,r.jsxs)("div",{className:"flex space-x-1 mt-2",children:[(0,r.jsxs)("button",{onClick:t=>{t.stopPropagation(),S(e)},disabled:w===(null===(t=e.data)||void 0===t?void 0:t.request_id),className:"flex-1 px-2 py-1 bg-green-600 text-white text-xs rounded hover:bg-green-700 disabled:bg-gray-400 transition-colors flex items-center justify-center space-x-1",children:[(0,r.jsx)(h.Z,{className:"h-3 w-3"}),(0,r.jsx)("span",{children:"Aceitar"})]}),(0,r.jsxs)("button",{onClick:t=>{t.stopPropagation(),k(e)},disabled:w===(null===(a=e.data)||void 0===a?void 0:a.request_id),className:"flex-1 px-2 py-1 bg-red-600 text-white text-xs rounded hover:bg-red-700 disabled:bg-gray-400 transition-colors flex items-center justify-center space-x-1",children:[(0,r.jsx)(x.Z,{className:"h-3 w-3"}),(0,r.jsx)("span",{children:"Recusar"})]})]}),"request_accepted"===e.type&&(null===(s=e.data)||void 0===s?void 0:s.owner_message)&&(0,r.jsxs)("div",{className:"mt-2 p-2 bg-green-50 rounded text-xs text-green-800",children:[(0,r.jsx)(g.Z,{className:"h-3 w-3 inline mr-1"}),e.data.owner_message]}),"request_rejected"===e.type&&(null===(o=e.data)||void 0===o?void 0:o.owner_message)&&(0,r.jsxs)("div",{className:"mt-2 p-2 bg-red-50 rounded text-xs text-red-800",children:[(0,r.jsx)(g.Z,{className:"h-3 w-3 inline mr-1"}),e.data.owner_message]})]})]})},e.id)}):(0,r.jsxs)("div",{className:"p-4 text-center text-gray-500",children:[(0,r.jsx)(u.Z,{className:"h-6 w-6 mx-auto mb-2 text-gray-300"}),(0,r.jsx)("p",{className:"text-sm",children:"Fa\xe7a login para ver notifica\xe7\xf5es"})]})}),a.length>3&&(0,r.jsx)("div",{className:"p-2 bg-gray-50 text-center border-t",children:(0,r.jsx)("button",{onClick:()=>m(!1),className:"text-xs text-gray-600 hover:text-gray-900",children:"Ver todas as notifica\xe7\xf5es"})})]}),d&&(0,r.jsx)("div",{className:"fixed inset-0 z-40",onClick:()=>m(!1)})]})}function N(e){let{userId:t,onAddBook:a,onLogout:f}=e,g=(0,o.usePathname)(),h=e=>"/"===e?"/"===g||""===g:g.startsWith(e);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("header",{className:"bg-white shadow-sm border-b sticky top-0 z-40",children:(0,r.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,r.jsxs)("div",{className:"flex justify-between items-center h-16",children:[(0,r.jsxs)(s.default,{href:"/",className:"flex items-center space-x-4 hover:opacity-80",children:[(0,r.jsx)(l.Z,{className:"h-8 w-8 text-blue-600"}),(0,r.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:"BookShare"})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,r.jsx)(w,{userId:t}),(0,r.jsxs)(i.z,{onClick:a,className:"bg-blue-600 hover:bg-blue-700",children:[(0,r.jsx)(l.Z,{className:"h-4 w-4 mr-2"}),"Adicionar Livro"]}),(0,r.jsx)(s.default,{href:"/profile",children:(0,r.jsxs)(i.z,{variant:"outline",children:[(0,r.jsx)(c.Z,{className:"h-4 w-4 mr-2"}),"Perfil"]})}),(0,r.jsx)(i.z,{variant:"outline",onClick:f,children:"Sair"})]})]})})}),(0,r.jsx)("nav",{className:"bg-white border-b",children:(0,r.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,r.jsxs)("div",{className:"flex space-x-8",children:[(0,r.jsx)(s.default,{href:"/",className:"py-4 px-1 border-b-2 font-medium text-sm transition-colors ".concat(!h("/")||g.includes("/my-books")||g.includes("/profile")?"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300":"border-blue-500 text-blue-600"),children:(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(l.Z,{className:"h-4 w-4"}),(0,r.jsx)("span",{children:"Explorar Livros"})]})}),(0,r.jsx)(s.default,{href:"/my-books",className:"py-4 px-1 border-b-2 font-medium text-sm transition-colors ".concat(h("/my-books")?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(d.Z,{className:"h-4 w-4"}),(0,r.jsx)("span",{children:"Meus Livros"})]})}),(0,r.jsx)(s.default,{href:"/requests",className:"py-4 px-1 border-b-2 font-medium text-sm transition-colors ".concat(h("/requests")?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(u.Z,{className:"h-4 w-4"}),(0,r.jsx)("span",{children:"Solicita\xe7\xf5es"})]})}),(0,r.jsx)("div",{className:"py-4 px-1 border-b-2 border-transparent text-gray-400 font-medium text-sm cursor-not-allowed",children:(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(m.Z,{className:"h-4 w-4"}),(0,r.jsx)("span",{children:"Chat"}),(0,r.jsx)(n.C,{variant:"secondary",className:"text-xs",children:"Em breve"})]})})]})})})]})}},5974:function(e,t,a){a.d(t,{C:function(){return l}});var r=a(7437);a(2265);var s=a(7495),o=a(535),i=a(4508);let n=(0,o.j)("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function l(e){let{className:t,variant:a,asChild:o=!1,...l}=e,c=o?s.g7:"span";return(0,r.jsx)(c,{"data-slot":"badge",className:(0,i.cn)(n({variant:a}),t),...l})}},2869:function(e,t,a){a.d(t,{z:function(){return l}});var r=a(7437);a(2265);var s=a(7495),o=a(535),i=a(4508);let n=(0,o.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function l(e){let{className:t,variant:a,size:o,asChild:l=!1,...c}=e,d=l?s.g7:"button";return(0,r.jsx)(d,{"data-slot":"button",className:(0,i.cn)(n({variant:a,size:o,className:t})),...c})}},6070:function(e,t,a){a.d(t,{Ol:function(){return i},SZ:function(){return l},Zb:function(){return o},aY:function(){return c},ll:function(){return n}});var r=a(7437);a(2265);var s=a(4508);function o(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"card",className:(0,s.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",t),...a})}function i(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"card-header",className:(0,s.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",t),...a})}function n(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"card-title",className:(0,s.cn)("leading-none font-semibold",t),...a})}function l(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"card-description",className:(0,s.cn)("text-muted-foreground text-sm",t),...a})}function c(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"card-content",className:(0,s.cn)("px-6",t),...a})}},5186:function(e,t,a){a.d(t,{I:function(){return o}});var r=a(7437);a(2265);var s=a(4508);function o(e){let{className:t,type:a,...o}=e;return(0,r.jsx)("input",{type:a,"data-slot":"input",className:(0,s.cn)("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",t),...o})}},6815:function(e,t,a){a.d(t,{_:function(){return i}});var r=a(7437);a(2265);var s=a(6394),o=a(4508);function i(e){let{className:t,...a}=e;return(0,r.jsx)(s.f,{"data-slot":"label",className:(0,o.cn)("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",t),...a})}},3647:function(e,t,a){a.d(t,{Bw:function(){return m},Ph:function(){return c},Ql:function(){return f},i4:function(){return u},ki:function(){return d}});var r=a(7437);a(2265);var s=a(520),o=a(875),i=a(401),n=a(2135),l=a(4508);function c(e){let{...t}=e;return(0,r.jsx)(s.fC,{"data-slot":"select",...t})}function d(e){let{...t}=e;return(0,r.jsx)(s.B4,{"data-slot":"select-value",...t})}function u(e){let{className:t,size:a="default",children:i,...n}=e;return(0,r.jsxs)(s.xz,{"data-slot":"select-trigger","data-size":a,className:(0,l.cn)("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-fit items-center justify-between gap-2 rounded-md border bg-transparent px-3 py-2 text-sm whitespace-nowrap shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...n,children:[i,(0,r.jsx)(s.JO,{asChild:!0,children:(0,r.jsx)(o.Z,{className:"size-4 opacity-50"})})]})}function m(e){let{className:t,children:a,position:o="popper",...i}=e;return(0,r.jsx)(s.h_,{children:(0,r.jsxs)(s.VY,{"data-slot":"select-content",className:(0,l.cn)("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md","popper"===o&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:o,...i,children:[(0,r.jsx)(g,{}),(0,r.jsx)(s.l_,{className:(0,l.cn)("p-1","popper"===o&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"),children:a}),(0,r.jsx)(h,{})]})})}function f(e){let{className:t,children:a,...o}=e;return(0,r.jsxs)(s.ck,{"data-slot":"select-item",className:(0,l.cn)("focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",t),...o,children:[(0,r.jsx)("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:(0,r.jsx)(s.wU,{children:(0,r.jsx)(i.Z,{className:"size-4"})})}),(0,r.jsx)(s.eT,{children:a})]})}function g(e){let{className:t,...a}=e;return(0,r.jsx)(s.u_,{"data-slot":"select-scroll-up-button",className:(0,l.cn)("flex cursor-default items-center justify-center py-1",t),...a,children:(0,r.jsx)(n.Z,{className:"size-4"})})}function h(e){let{className:t,...a}=e;return(0,r.jsx)(s.$G,{"data-slot":"select-scroll-down-button",className:(0,l.cn)("flex cursor-default items-center justify-center py-1",t),...a,children:(0,r.jsx)(o.Z,{className:"size-4"})})}},6818:function(e,t,a){a.d(t,{g:function(){return o}});var r=a(7437);a(2265);var s=a(4508);function o(e){let{className:t,...a}=e;return(0,r.jsx)("textarea",{"data-slot":"textarea",className:(0,s.cn)("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),...a})}},7992:function(e,t,a){a.d(t,{Am:function(){return d}}),a(2265);let r=0,s=new Map,o=e=>{if(s.has(e))return;let t=setTimeout(()=>{s.delete(e),c({type:"REMOVE_TOAST",toastId:e})},1e6);s.set(e,t)},i=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:a}=t;return a?o(a):e.toasts.forEach(e=>{o(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===a||void 0===a?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},n=[],l={toasts:[]};function c(e){l=i(l,e),n.forEach(e=>{e(l)})}function d(e){let{...t}=e,a=(r=(r+1)%Number.MAX_SAFE_INTEGER).toString(),s=()=>c({type:"DISMISS_TOAST",toastId:a});return c({type:"ADD_TOAST",toast:{...t,id:a,open:!0,onOpenChange:e=>{e||s()}}}),{id:a,dismiss:s,update:e=>c({type:"UPDATE_TOAST",toast:{...e,id:a}})}}},6128:function(e,t,a){a.d(t,{AuthProvider:function(){return n},a:function(){return l}});var r=a(7437),s=a(2265),o=a(5452);let i=(0,s.createContext)(void 0);function n(e){let{children:t}=e,[a,n]=(0,s.useState)(null),[l,c]=(0,s.useState)(null),[d,u]=(0,s.useState)(!0),[m,f]=(0,s.useState)(!0),g=(0,o.createClientComponentClient)(),{wasHardRefresh:h}=function(){let e=(0,s.useRef)(!1);return(0,s.useEffect)(()=>{let t=performance.getEntriesByType("navigation");if(t.length>0){let a=t[0];e.current="reload"===a.type,e.current&&console.log("\uD83D\uDD04 Hard refresh detectado - preservando estado de autentica\xe7\xe3o")}let a=t=>{(t.altKey&&"F5"===t.key||t.ctrlKey&&"F5"===t.key||t.ctrlKey&&t.shiftKey&&"R"===t.key||t.metaKey&&t.shiftKey&&"R"===t.key)&&(console.log("Hard refresh key combination detected"),e.current=!0,sessionStorage.setItem("hardRefreshFlag","true"))};return sessionStorage.getItem("hardRefreshFlag")&&(console.log("Previous hard refresh detected from sessionStorage"),e.current=!0,sessionStorage.removeItem("hardRefreshFlag")),document.addEventListener("keydown",a),()=>{document.removeEventListener("keydown",a)}},[]),{wasHardRefresh:e.current}}(),x=e=>{if(!e)return!1;let t=Math.floor(Date.now()/1e3);return!e.expires_at||e.expires_at>t},p=e=>{if(!e)return!1;let t=Math.floor(Date.now()/1e3);return!!e.expires_at&&e.expires_at<t+300},v=async()=>{try{console.log("Tentando renovar sess\xe3o...");let{data:e,error:t}=await g.auth.refreshSession();if(t)return console.error("Erro ao renovar sess\xe3o:",t),!1;if(e.session)return console.log("Sess\xe3o renovada com sucesso!"),c(e.session),n(e.session.user),!0;return!1}catch(e){return console.error("Erro inesperado ao renovar sess\xe3o:",e),!1}};(0,s.useEffect)(()=>{let e=!0,t=setTimeout(()=>{e&&(console.log("[AuthContext] FailSafe: liberando loading ap\xf3s timeout"),u(!1))},3e3),a=async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3;try{if(console.log("Getting initial session, attempt:",4-t),m||h){let e=h?300:100;console.log("Waiting ".concat(e,"ms for Supabase client initialization...")),await new Promise(t=>setTimeout(t,e))}let{data:{session:s},error:o}=await g.auth.getSession();if(!e)return;if(o){if(console.warn("[AuthContext] Erro ao obter sess\xe3o:",o.message),t>0){setTimeout(()=>a(t-1),200);return}c(null),n(null)}else{var r;console.log("Initial session loaded:",(null==s?void 0:null===(r=s.user)||void 0===r?void 0:r.email)||"No user"),s&&x(s)?(c(s),n(s.user)):(c(null),n(null))}}catch(e){console.error("[AuthContext] Exce\xe7\xe3o getInitialSession:",e)}finally{e&&(u(!1),f(!1))}};a();let{data:{subscription:r}}=g.auth.onAuthStateChange((t,a)=>{if(e)switch(console.log("[AuthContext] Auth event:",t),t){case"SIGNED_IN":case"TOKEN_REFRESHED":case"INITIAL_SESSION":var r;c(a),n(null!==(r=null==a?void 0:a.user)&&void 0!==r?r:null),u(!1);break;case"SIGNED_OUT":c(null),n(null),u(!1)}}),s=setInterval(()=>{l&&p(l)&&(console.log("Sess\xe3o expirando em breve, renovando automaticamente..."),v())},6e4);return()=>{console.log("Cleaning up auth subscription and timers"),e=!1,clearTimeout(t),r.unsubscribe(),clearInterval(s)}},[g.auth,m]);let b=async()=>{try{console.log("Signing out user explicitly"),u(!0),c(null),n(null);let{error:e}=await g.auth.signOut();e?console.error("Error signing out:",e):console.log("Successfully signed out")}catch(e){console.error("Error signing out:",e)}finally{u(!1)}};return(0,r.jsx)(i.Provider,{value:{user:a,session:l,loading:d,signOut:b},children:t})}function l(){let e=(0,s.useContext)(i);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},5427:function(e,t,a){a.d(t,{X:function(){return o}});var r=a(2265),s=a(970);function o(e){let[t,a]=(0,r.useState)([]),[o,i]=(0,r.useState)(!0),n=async()=>{try{console.log("\uD83D\uDCCB Buscando solicita\xe7\xf5es para propriet\xe1rio:",e);let{data:t,error:r}=await s.OQ.from("requests").select("\n          *,\n          book:books(title, author),\n          requester:profiles(name, email)\n        ").eq("owner_id",e).order("created_at",{ascending:!1});if(r)throw r;a(t||[]),console.log("✅ Solicita\xe7\xf5es carregadas:",(null==t?void 0:t.length)||0)}catch(e){console.error("❌ Erro ao buscar solicita\xe7\xf5es:",e)}finally{i(!1)}},l=async(t,a,r,o)=>{try{let{data:i,error:n}=await s.OQ.from("requests").insert({book_id:t,requester_id:e,owner_id:a,message:r.trim(),meeting_location:o,status:"pending"}).select().single();if(n)throw n;return await s.OQ.from("notifications").insert({user_id:a,type:"book_request",title:"Nova solicita\xe7\xe3o de empr\xe9stimo",message:'Algu\xe9m quer pedir emprestado seu livro. Mensagem: "'.concat(r.substring(0,100)).concat(r.length>100?"...":"",'"'),read:!1}),i}catch(e){throw console.error("Erro ao criar solicita\xe7\xe3o:",e),e}},c=async(e,t,a)=>{try{let{data:r,error:o}=await s.OQ.from("requests").update({status:t,updated_at:new Date().toISOString()}).eq("id",e).select("\n          *,\n          book:books(title, author),\n          requester:profiles(name, email)\n        ").single();if(o)throw o;return await s.OQ.from("notifications").insert({user_id:r.requester_id,type:"accepted"===t?"request_accepted":"request_rejected",title:"accepted"===t?"Solicita\xe7\xe3o aceita!":"Solicita\xe7\xe3o recusada",message:"accepted"===t?"Sua solicita\xe7\xe3o de empr\xe9stimo foi aceita! ".concat(a||""):"Sua solicita\xe7\xe3o de empr\xe9stimo foi recusada. ".concat(a||""),read:!1}),r}catch(e){throw console.error("Erro ao responder solicita\xe7\xe3o:",e),e}};return(0,r.useEffect)(()=>{n();let t=s.OQ.channel("requests_changes").on("postgres_changes",{event:"*",schema:"public",table:"requests",filter:"owner_id=eq.".concat(e)},e=>{console.log("Request change received:",e),n()}).subscribe();return()=>{s.OQ.removeChannel(t)}},[e]),{requests:t,loading:o,createRequest:l,respondToRequest:c,refetch:n}}},970:function(e,t,a){a.d(t,{OQ:function(){return i}});var r=a(8439);let s="https://nbdxkuobsqvrhnplopzs.supabase.co",o="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5iZHhrdW9ic3F2cmhucGxvcHpzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc0NTQ3NzksImV4cCI6MjA3MzAzMDc3OX0.Iwyh3_1vHf_piyqF-RtNbjU9UBdzJ2DmEy5pLRLCW98";if(!s)throw Error("❌ NEXT_PUBLIC_SUPABASE_URL n\xe3o est\xe1 definida no arquivo .env.local");if(!o)throw Error("❌ NEXT_PUBLIC_SUPABASE_ANON_KEY n\xe3o est\xe1 definida no arquivo .env.local");let i=(0,r.eI)(s,o,{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0},realtime:{params:{eventsPerSecond:10}}})},4508:function(e,t,a){a.d(t,{cn:function(){return o}});var r=a(1994),s=a(3335);function o(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,s.m6)((0,r.W)(t))}}}]);